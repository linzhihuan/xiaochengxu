<view class="container safe-nav-space safe-bottom">
  <!-- <view class="user-header fade-in-up">
    <view class="avatar-box" bindtap="handleAuth">
      <image wx:if="{{isLogin}}" src="../../images/default-avatar.png" class="avatar"></image> 
      <view wx:else class="avatar-placeholder">登录</view>
    </view>
    <view class="user-info" bindtap="handleAuth">
      <text class="nickname font-serif">{{isLogin ? 'WeChat User' : 'Guest-未登录'}}</text>
      <text class="user-desc">{{isLogin ? 'Welcome back.' : 'Tap to sync your gallery.'}}</text>
    </view>
  </view> -->

<!-- 顶部：个人资料卡片 -->
<view class="profile-card fade-in-up">
    
    <!-- 头像选择区 -->
    <view class="avatar-wrapper">
      <!-- 微信原生能力：头像选择按钮 -->
      <button 
        class="avatar-btn" 
        open-type="chooseAvatar" 
        bindchooseavatar="onChooseAvatar"
      >
        <image 
          class="avatar-img" 
          src="{{avatarUrl || '/images/default-avatar.png'}}" 
          mode="aspectFill"
        ></image>
        <view class="edit-icon" wx:if="{{!isLogin}}">✎</view>
      </button>
    </view>

    <!-- 昵称输入区 -->
    <view class="info-form">
      <view class="input-group">
        <text class="label">Nickname</text>
        <!-- 微信原生能力：昵称填写 -->
        <input 
          type="nickname" 
          class="nickname-input" 
          placeholder="Enter your name" 
          placeholder-class="ph-color"
          value="{{nickName}}"
          bindblur="onInputNickname"
          bindinput="onInputNickname"
        />
      </view>
      
      <!-- 保存按钮 -->
      <view class="save-btn-area" >
        <view wx:if= "{{isLogin}}" class="btn-save" bindtap="handleUpdateUser">
          Update Profile
        </view>
        <view wx:if= "{{!isLogin}}" class="btn-save" bindtap="handleRegistUser">
          Regist
        </view>
        <view wx:if= "{{!isLogin}}" class="btn-save" bindtap="handleLoginUser">
          Login
        </view>
      </view>
    </view>

  </view>



  <view class="section-header fade-in-up delay-1">
    <text class="section-title">我的收藏</text>
    <view class="line"></view>
  </view>

  <view wx:if="{{isLogin && favorites.length === 0}}" class="empty-state fade-in-up delay-2">
    <text>No collections yet.</text>
    <button class="btn-ghost mt-4" bindtap="goExplore">Explore Now</button>
  </view>

  <view wx:if="{{!isLogin}}" class="empty-state fade-in-up delay-2">
    <text>请登录查看收藏列表哦~</text>
  </view>

  <view class="fav-grid fade-in-up delay-2" wx:if="{{isLogin && favorites.length > 0}}">
    <block wx:for="{{favorites}}" wx:key="id">
      <view class="fav-item" bindtap="goDetail" data-item="{{item}}">
        <image src="{{item.img}}" mode="aspectFill" class="fav-img"></image>
        <view class="fav-meta">
          <text class="fav-tag">{{item.tag}}</text>
          <text class="fav-title">{{item.title}}</text>
        </view>
      </view>
    </block>
  </view>
</view>